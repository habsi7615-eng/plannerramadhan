<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Ramadan Tracker Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</head>

<body class="bg-green-50 min-h-screen p-6">

  <div class="max-w-3xl mx-auto">

    <!-- HEADER -->
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-green-800">
        ðŸŒ™ Ramadan Tracker Ultimate Pro
      </h1>
      <p class="text-gray-600">Checklist Harian + Rekap 30 Hari + Export PDF</p>
    </div>

    <!-- LOGIN -->
    <div class="card bg-white p-6 rounded-2xl shadow mb-6">
      <h2 class="text-xl font-bold text-green-800 mb-3">
        ðŸ”‘ Login WhatsApp
      </h2>

      <input id="wa"
        class="w-full border rounded-xl p-3 mb-3"
        placeholder="Masukkan Nomor WhatsApp (contoh: 0852xxxx)">

      <button onclick="loginUser()"
        class="w-full py-3 rounded-xl bg-green-700 text-white font-bold">
        Masuk
      </button>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" style="display:none;">

      <!-- CHECKLIST -->
      <div class="card bg-white p-6 rounded-2xl shadow mb-6">
        <h2 class="text-xl font-bold text-green-800 mb-3">
          ðŸ•Œ Checklist Ibadah Hari Ini
        </h2>

        <p class="text-sm text-gray-500 mb-3">
          Tanggal: <span id="todayDate"></span>
        </p>

        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm">

          <label><input type="checkbox" id="subuh"> Subuh</label>
          <label><input type="checkbox" id="dzuhur"> Dzuhur</label>
          <label><input type="checkbox" id="ashar"> Ashar</label>
          <label><input type="checkbox" id="maghrib"> Maghrib</label>
          <label><input type="checkbox" id="isya"> Isya</label>

          <label><input type="checkbox" id="tarawih"> Tarawih</label>
          <label><input type="checkbox" id="witir"> Witir</label>
          <label><input type="checkbox" id="dhuha"> Dhuha</label>
          <label><input type="checkbox" id="taubat"> Taubat</label>
          <label><input type="checkbox" id="hajat"> Hajat</label>
          <label><input type="checkbox" id="sedekah"> Sedekah</label>

        </div>

        <button onclick="saveChecklist()"
          class="mt-4 w-full py-3 rounded-xl bg-green-700 text-white font-bold">
          ðŸ’¾ Simpan Checklist Hari Ini
        </button>
      </div>

      <!-- REKAP 30 HARI -->
      <div class="card bg-white p-6 rounded-2xl shadow mb-6">
        <h2 class="text-xl font-bold text-green-800 mb-3">
          ðŸ“Š Rekap Checklist 30 Hari
        </h2>

        <div id="rekapBox" class="text-sm text-gray-700 space-y-2">
          <!-- isi otomatis -->
        </div>
      </div>

      <!-- EXPORT PDF -->
      <div class="card bg-white p-6 rounded-2xl shadow mb-6">
        <h2 class="text-xl font-bold text-green-800 mb-3">
          ðŸ“„ Export Laporan PDF
        </h2>

        <button onclick="exportPDF()"
          class="w-full py-3 rounded-xl bg-emerald-800 text-white font-bold">
          ðŸ“„ Export PDF Rekap 30 Hari
        </button>
      </div>

    </div>
  </div>

<script>
  let currentUser = "";

  // âœ… Ambil tanggal hari ini
  function getToday() {
    const d = new Date();
    return d.toISOString().split("T")[0]; // format YYYY-MM-DD
  }

  // LOGIN
  function loginUser() {
    const wa = document.getElementById("wa").value.trim();
    if (!wa) return alert("Masukkan nomor WhatsApp!");

    currentUser = wa;

    document.getElementById("dashboard").style.display = "block";
    document.getElementById("todayDate").innerText = getToday();

    loadChecklistToday();
    loadRekap();
  }

  // âœ… Simpan checklist berdasarkan tanggal
  function saveChecklist() {
    const boxes = document.querySelectorAll("input[type='checkbox']");
    let data = {};

    boxes.forEach((b) => {
      data[b.id] = b.checked;
    });

    const todayKey = "checklist_" + currentUser + "_" + getToday();
    localStorage.setItem(todayKey, JSON.stringify(data));

    alert("âœ… Checklist hari ini tersimpan!");

    // reset checkbox
    boxes.forEach((b) => b.checked = false);

    loadRekap();
  }

  // âœ… Load checklist hari ini jika sudah pernah disimpan
  function loadChecklistToday() {
    const todayKey = "checklist_" + currentUser + "_" + getToday();
    const saved = localStorage.getItem(todayKey);

    if (!saved) return;

    const data = JSON.parse(saved);

    Object.keys(data).forEach((id) => {
      const box = document.getElementById(id);
      if (box) box.checked = data[id];
    });
  }

  // âœ… Rekap 30 hari terakhir
  function loadRekap() {
    const rekapBox = document.getElementById("rekapBox");
    rekapBox.innerHTML = "";

    let count = 0;

    for (let i = 0; i < 30; i++) {
      const d = new Date();
      d.setDate(d.getDate() - i);

      const dateKey = d.toISOString().split("T")[0];
      const storageKey = "checklist_" + currentUser + "_" + dateKey;

      const saved = localStorage.getItem(storageKey);
      if (saved) {
        count++;

        const data = JSON.parse(saved);

        let done = Object.values(data).filter(v => v).length;

        rekapBox.innerHTML += `
          <div class="p-2 border rounded-xl">
            ðŸ“… <b>${dateKey}</b> â€” âœ… ${done}/11 ibadah
          </div>
        `;
      }
    }

    if (count === 0) {
      rekapBox.innerHTML = "<p class='text-gray-400'>Belum ada data tersimpan.</p>";
    }
  }

  // âœ… Export PDF Rekap
  async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(14);
    doc.text("ðŸŒ™ Rekap Checklist Ramadan (30 Hari)", 10, 10);

    let y = 20;

    for (let i = 0; i < 30; i++) {
      const d = new Date();
      d.setDate(d.getDate() - i);

      const dateKey = d.toISOString().split("T")[0];
      const storageKey = "checklist_" + currentUser + "_" + dateKey;

      const saved = localStorage.getItem(storageKey);

      if (saved) {
        const data = JSON.parse(saved);
        let done = Object.values(data).filter(v => v).length;

        doc.text(`${dateKey} : ${done}/11 ibadah`, 10, y);
        y += 8;

        if (y > 280) {
          doc.addPage();
          y = 20;
        }
      }
    }

    doc.save("rekap-ramadan.pdf");
  }

</script>

</body>
</html>
