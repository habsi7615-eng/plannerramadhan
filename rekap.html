<!DOCTYPE html>
<html lang="id">
<head>
    <style>
/* ===== MOBILE FRIENDLY ===== */
@media (max-width: 600px) {

  body {
    font-family: Arial, sans-serif;
    padding: 10px;
  }

  h1, h2 {
    text-align: center;
  }

  table {
    width: 100%;
    font-size: 12px;
  }

  th, td {
    padding: 6px;
    text-align: center;
  }

  /* Scroll tabel */
  table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }

  canvas {
    width: 100% !important;
    height: auto !important;
  }

  button {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    margin-top: 10px;
  }
}
</style>

    <style>
@media print {
  button {
    display: none;
  }
  canvas {
    display: none;
  }
}
</style>

    <style>
  .malam-akhir {
    background-color: #fff4c2;
  }
</style>

  <meta charset="UTF-8">
  <title>Rekap Ramadan</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>REKAP RAMADAN</h1>

<table border="1" id="rekapTable">
  <thead>
    <tr>
      <th>Hari</th>
      <th>Wajib</th>
      <th>Sunnah</th>
      <th>Tilawah</th>
      <th>Skor</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<br>
<b>Total Skor:</b> <span id="totalSkor">0</span><br>
<b>Level:</b> <span id="levelRamadan">-</span>
<h2>Grafik Perkembangan Ibadah</h2>
<canvas id="grafikIbadah" width="600" height="300"></canvas>
<h2>Raport Ramadan</h2>
<p>Total Skor: <span id="raportSkor">0</span></p>
<p>Nilai: <span id="raportNilai">-</span></p>
<p id="raportCatatan"></p><button onclick="window.print()">Cetak Raport Ramadan</button>

<script src="https://cdn.jsdelivr.net/npm/chart.js">let chart;

function updateGrafik() {
  const rows = document.querySelectorAll("#rekapTable tbody tr");
  const labels = [];
  const data = [];

  rows.forEach((row, i) => {
    labels.push("Hari " + (i + 1));
    data.push(parseInt(row.cells[4].innerText));
  });

  if (chart) chart.destroy();

  const ctx = document.getElementById("grafikIbadah").getContext("2d");
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        label: "Skor Ibadah",
        data: data,
        fill: false,
        tension: 0.3
      }]
    }
  });
}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
let chart;

window.onload = function () {
  const tbody = document.querySelector("#rekapTable tbody");

  for (let i = 1; i <= 30; i++) {
    const row = document.createElement("tr");
    if (i >= 21) row.classList.add("malam-akhir");

    row.innerHTML = `
      <td>${i}</td>
      <td><input type="checkbox" onchange="simpan(); hitung()"></td>
      <td><input type="checkbox" onchange="simpan(); hitung()"></td>
      <td><input type="checkbox" onchange="simpan(); hitung()"></td>
      <td>0</td>
    `;
    tbody.appendChild(row);
  }

  const saved = JSON.parse(localStorage.getItem("ramadanData"));
  if (saved) {
    const rows = document.querySelectorAll("#rekapTable tbody tr");
    saved.forEach((d, i) => {
      rows[i].cells[1].querySelector("input").checked = d.wajib;
      rows[i].cells[2].querySelector("input").checked = d.sunnah;
      rows[i].cells[3].querySelector("input").checked = d.tilawah;
    });
  }

  hitung();
};

function simpan() {
  const rows = document.querySelectorAll("#rekapTable tbody tr");
  const data = [];

  rows.forEach(r => {
    data.push({
      wajib: r.cells[1].querySelector("input").checked,
      sunnah: r.cells[2].querySelector("input").checked,
      tilawah: r.cells[3].querySelector("input").checked
    });
  });

  localStorage.setItem("ramadanData", JSON.stringify(data));
}

function hitung() {
  let total = 0;
  const rows = document.querySelectorAll("#rekapTable tbody tr");

  rows.forEach(r => {
    let skor = 0;
    if (r.cells[1].querySelector("input").checked) skor += 2;
    if (r.cells[2].querySelector("input").checked) skor += 1;
    if (r.cells[3].querySelector("input").checked) skor += 1;

    r.cells[4].innerText = skor;
    total += skor;
  });

  document.getElementById("totalSkor").innerText = total;
  document.getElementById("levelRamadan").innerText =
    total >= 70 ? "Istiqamah" :
    total >= 40 ? "Baik" : "Perlu Diperbaiki";

  updateGrafik();
document.getElementById("raportSkor").innerText = total;

let nilai = "-";
let catatan = "";

if (total >= 70) {
  nilai = "A";
  catatan = "MasyaAllah, ibadah sangat baik.";
} else if (total >= 50) {
  nilai = "B";
  catatan = "Sudah baik, pertahankan.";
} else if (total >= 30) {
  nilai = "C";
  catatan = "Cukup, masih bisa ditingkatkan.";
} else {
  nilai = "D";
  catatan = "Perlu lebih semangat beribadah.";
}

document.getElementById("raportNilai").innerText = nilai;
document.getElementById("raportCatatan").innerText = catatan;
}

function updateGrafik() {
  const rows = document.querySelectorAll("#rekapTable tbody tr");
  const labels = [];
  const data = [];

  rows.forEach((r, i) => {
    labels.push("Hari " + (i + 1));
    data.push(Number(r.cells[4].innerText));
  });

  if (chart) chart.destroy();

  chart = new Chart(
    document.getElementById("grafikIbadah"),
    {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "Skor Ibadah",
          data: data,
          tension: 0.3
        }]
      }
    }
  );
}
</script>


</body>
</html>

